"use strict";var googleError=function(){var i='<div class="google-error"><div class="half-screen"></div><h1>We cannot get data from the Google Maps ðŸ˜¿</h1><h1> Please try again later</h1></div>';$("#map").append(i)},googleSuccess=function(){var i=function(){var i=this;this.map={},this.markerList=ko.observableArray([]),this.currentMarkerList=ko.observableArray([]),this.searchString=ko.observable(""),this.hideButton=ko.observable("â–²"),this.starButton=ko.observable("â˜…"),this.showOnlyFavourites=ko.observable(!1),this.infoWindowsOpened=[],this.contentStringTemplate='<div class="container"><div class="full-width"><h4>%Label%</h4></div><div class="full-width"><a href="%WikiLinkLoc%">%WikiLinkText%</a><p>%WikiInfo%</p></div><div class="full-width"><img class="image-flickr" src=%Image0% alt="city image"></img><img class="image-flickr" src=%Image1% alt="city image"></img><img class="image-flickr" src=%Image2% alt="city image"></img></div></div>',this.initMap=function(e,t){this.map=new google.maps.Map(document.getElementById("map"),{center:e.position,zoom:e.zoom});for(var a=t.length,o=[],r=0;a>r;r++)o.push(this.createMarker(t[r].position,t[r].title,t[r].icon));i.markerList(o),i.getInfoFromWiki(i.markerList()),i.getInfoFromFlickr(i.markerList()),i.currentMarkerList(o)},this.getInfoFromWiki=function(i){var e="https://en.wikipedia.org/w/api.php?action=opensearch&search=%request%&format=json&callback=wikiCallback",t=setTimeout(function(){marker.wikiSuccess=!1},8e3);i.forEach(function(i){$.ajax({url:e.replace("%request%",i.title),dataType:"jsonp",success:function(e){i.wikiSuccess=!0,clearTimeout(t),i.wikiData=e}})})},this.getInfoFromFlickr=function(i){var e="https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=ec08162143dcb46549ffc0535cdbc2cc&&tags=%tags%&sort=interestingness-desc&per_page=3&content_type=1&media=photos&nojsoncallback=1&format=json&lat=%lat%&lon=%lon%",t="https://farm%farm-id%.staticflickr.com/%server-id%/%id%_%secret%_q.jpg",a="church, monument, square, nature, travel, architecture, city, museum, flowers, holidays",o=setTimeout(function(){marker.flickrSuccess=!1},8e3);i.forEach(function(i){$.ajax({url:e.replace("%lat%",i.position.lat).replace("%lon%",i.position.lng).replace("%tags%",a),success:function(e){clearTimeout(o),i.flickrSuccess=!0,i.flickrData=[];for(var a=0;3>a;a++){var r=e.photos.photo[a];i.flickrData[a]=t.replace("%farm-id%",r.farm).replace("%server-id%",r.server),i.flickrData[a]=i.flickrData[a].replace("%id%",r.id).replace("%secret%",r.secret)}}})})},this.centerMapClick=function(){i.mapZoom(mapData.mapCenter.zoom,mapData.mapCenter.position)},this.cityZoomClick=function(){i.mapZoom(14,this.position)},this.mapZoom=function(e,t){i.map.setZoom(e),i.map.setCenter(t)},this.clearSearchClick=function(){this.searchString(""),i.filterLocations()},this.hideButtonClick=function(){var e=$(".main-container"),t=0;"â–²"===i.hideButton()?(i.hideButton("â–¼"),t=e.offset().top-e.height()+20,e.offset({top:t,left:0})):(i.hideButton("â–²"),t=e.offset().top+e.height()-20,e.offset({top:t,left:0}))},this.markerClick=function(e){i.infoWindowsOpened.forEach(function(i){i.close()}),e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},2e3);var t=new google.maps.InfoWindow({content:i.markerDataToHTML(e,i.contentStringTemplate)});t.open(i.map,e),i.infoWindowsOpened.push(t)},this.showFavouritesClick=function(){i.showOnlyFavourites(!i.showOnlyFavourites()),i.filterLocations()},this.starButtonClick=function(){this.isFavourite(!this.isFavourite()),i.filterLocations()},this.createMarker=function(e,t,a){var o=new google.maps.Marker({position:e,map:this.map,title:t,icon:a,animation:google.maps.Animation.DROP,isFavourite:ko.observable(!1)});return o.addListener("click",function(){i.markerClick(o)}),o},this.markerDataToHTML=function(i,e){var t=e.replace("%Label%",i.title);return i.wikiSuccess===!0?(t=t.replace("%WikiInfo%",i.wikiData[2][0]),t=t.replace("%WikiLinkText%",i.wikiData[1][0]).replace("%WikiLinkLoc%",i.wikiData[3][0])):(t=t.replace("%WikiInfo%","Sorry, we can't get information from Wikipedia :-("),t=t.replace("%WikiLinkText%","").replace("%WikiLinkLoc%","")),i.flickrSuccess===!0?t=t.replace("%Image0%",i.flickrData[0]).replace("%Image1%",i.flickrData[1]).replace("%Image2%",i.flickrData[2]):(t=t.replace("%Image0%","images/err.png").replace("%Image1%","images/err.png").replace("%Image2%","images/err.png"),t=t.replace("city image","Images from Flickr cannot be downloaded")),t},this.filterLocations=function(){function e(i,e){for(var t=e.length,a=0;t>a;a++)e[a].setMap(i)}for(var t=this.searchString().toLowerCase(),a=[],o=this.markerList().length,r=0;o>r;r++)-1!==i.markerList()[r].title.toLowerCase().indexOf(t)&&(i.markerList()[r].isFavourite()===!0||i.showOnlyFavourites()===!1)&&a.push(i.markerList()[r]);this.currentMarkerList(a),e(null,this.markerList()),e(this.map,this.currentMarkerList())},this.initMap(mapData.mapCenter,mapData.markers)};ko.applyBindings(new i)},mapData={mapCenter:{position:{lat:56.236575,lng:37.909103},zoom:7},markers:[{position:{lat:56.307,lng:38.15},title:"Sergiyev Posad",icon:"dst/images/sergievposad.png"},{position:{lat:56.165,lng:40.402},title:"Vladimir",icon:"dst/images/vladimir.png"},{position:{lat:56.416,lng:40.453},title:"Suzdal",icon:"dst/images/suzdal.png"},{position:{lat:56.736,lng:38.882},title:"Pereslavl-Zalessky",icon:"dst/images/pereslavl.png"},{position:{lat:57.633,lng:39.855},title:"Yaroslavl",icon:"dst/images/yaroslavl.png"},{position:{lat:57.186,lng:39.411},title:"Rostov",icon:"dst/images/rostov.png"},{position:{lat:57.765,lng:40.925},title:"Kostroma",icon:"dst/images/kostroma.png"}]};